# 比特币定投收益演示网站说明

## 项目概览
- 静态网站，用于展示在自定义时间范围内的比特币定投（DCA）收益表现。
- 支持三类定投模式：
  - 每月固定日期（1–31）。若当月没有该日期，则使用当月最后一天。
  - 按 AHR999 指数阈值买入。可选阈值包含 `0.4/0.5/0.6/0.7/0.8/0.9/1.0/1.1/1.2`。
  - 按价格均线买入。可选均线窗口：`200/350/700/1000` 日；条件可选 `当日价格 ≤ 均线` 或 `当日价格 ≥ 均线`。
- 频率支持：
  - 满足条件的所有日期（每日筛选）。
  - 每月仅一次（若该月没有任何达标日，则回退到当月最后一天买入）。
- 页面展示：总投入、期末资产价值、收益/回报率、持币数量、买入次数；并提供资产价值与累计投入的对比折线图。悬浮显示当日价格与 AHR999 指数。

## 数据参考
- 价格数据文件：`btc-price all.csv`。
- 数据覆盖：2013-04-28 至今（每日自动更新）。
- 数据更新：每天北京时间 12:00 通过 GitHub Actions 自动同步最新价格。
- CSV 格式：
  - 表头：`date,btc price`
  - 日期格式：支持 `YYYY-MM-DD` 与 `YYYY/M/D`。
  - 价格单位：美元（USD）。
  - 排序方式：按日期倒序排列（最新日期在前）。

## 投资逻辑
- 时间范围：用户可自定义开始/结束日期；默认使用数据文件中的完整范围。
- 每次定投金额：用户可自定义，默认 `100 USD`。
- 每月固定日：
  - 对区间内每个自然月，选择用户设定的日期；若当月没有该日期，则以该月最后一天替代；该日需有价格记录。
- AHR999 阈值：
  - 当日 `AHR999 ≤ 阈值` 时买入；阈值含 `0.4` 等更保守选项。
- 价格均线：
  - 简单移动均线（SMA），窗口可选 `200/350/700/1000` 日。
  - 条件：当日价格相对均线的 `≤` 或 `≥`。
- 统计指标：
  - 累计投入 = 买入次数 × 每次定投金额。
  - 持币数量 = Σ(每次买入的金额 / 当日价格)。
  - 期末资产价值 = 持币数量 × 结束日期价格。
  - 收益 = 期末资产价值 − 累计投入；回报率 = 收益 / 累计投入。

## 算法说明
- 200 日定投成本（AHR999 计算用）：滚动窗口法计算 `C = 200 / Σ(1/pi)`，从第 200 天开始输出成本。
- 指数增长估值：`10^(5.84 × log10(币龄) − 17.01)`；币龄以 UTC 从 `2009-01-03` 起算并加 1。
- 简单移动均线（SMA）：对价格做窗口累加并除以窗口大小；从窗口满载开始输出均线值。

## 使用方法
- 本地预览：
  - 在项目根目录运行：`python3 -m http.server 8000`
  - 打开浏览器访问：`http://localhost:8000/`
- 页面操作：
  - 设置"每次定投金额（USD）"。
  - 设置"开始日期"和"结束日期"。
  - 选择模式：`每月固定日`、`按 AHR999 阈值` 或 `按价格均线`，并设置对应参数。
  - 点击"计算并更新"，刷新指标与图表。

## 目录结构
- `index.html`：页面结构、控件与图表容器（含三种模式的控件）。
- `styles.css`：样式与布局。
- `app.js`：数据解析、AHR999 与均线计算、策略与图表渲染。
- `btc-price all.csv`：每日价格数据源（自动更新）。
- `update_btc_price.py`：价格自动更新脚本。
- `.github/workflows/update-btc-price.yml`：GitHub Actions 自动化配置。
- `README.md`：项目说明文档（本文件）。

## 自动价格更新功能

### 工作原理
项目使用 GitHub Actions 实现每日比特币价格的自动更新：
- **触发时间**：每天北京时间 12:00（UTC 04:00）自动运行
- **数据源**：CoinGecko API（免费，无需 API Key）
- **更新流程**：
  1. GitHub Actions 工作流自动触发
  2. 运行 `update_btc_price.py` 脚本获取最新价格
  3. 将新价格追加到 `btc-price all.csv` 文件
  4. 自动提交并推送到仓库

### 手动触发更新
如需立即更新价格数据，可以：
1. 进入 GitHub 仓库的 "Actions" 页面
2. 选择 "每日更新比特币价格" 工作流
3. 点击 "Run workflow" 按钮手动触发

### 本地运行更新脚本
也可以在本地运行价格更新脚本：
```bash
# 安装依赖
pip install requests

# 运行更新脚本
python3 update_btc_price.py
```

### 配置说明
- **工作流文件**：`.github/workflows/update-btc-price.yml`
- **更新脚本**：`update_btc_price.py`
- **数据格式**：自动检测重复日期，避免重复添加
- **错误处理**：API 调用失败时会在 Actions 日志中显示错误信息

## 代码位置参考
- CSV 解析与数据加载：`app.js:11-12`
- 范围过滤：`app.js:13`
- 价格映射构建：`app.js:14`
- 200 日定投成本（滚动窗口）：`app.js:15`
- 指数增长估值：`app.js:16`
- 币龄计算：`app.js:17`
- AHR999 计算：`app.js:18`
- 简单移动均线（SMA）：`app.js:20`
- 每月固定日日期生成：`app.js:19-20`
- AHR999 日度/每月一次：`app.js:23-24`
- 均线日度/每月一次：`app.js:25-26`
- 收益序列与图表渲染：`app.js:27-28`
- 指标展示：`app.js:29`
- 模式切换与交互入口：`app.js:30-32`

## 更新日志

### 2025-11-20
- 🤖 **新增自动价格更新功能**
  - 每天北京时间 12:00 通过 GitHub Actions 自动获取并更新比特币价格
  - 使用 CoinGecko API 作为价格数据源（免费、稳定）
  - 新增 `update_btc_price.py` 自动更新脚本
  - 新增 `.github/workflows/update-btc-price.yml` 工作流配置
  - 支持手动触发价格更新
- 📊 **数据补全**
  - 补充 2025-11-16 至 2025-11-20 的价格数据
  - 数据现已覆盖 2013-04-28 至今
- 📝 **文档更新**
  - 完善 README 说明，新增自动更新功能章节
  - 更新数据覆盖范围说明

### 历史更新
- 切换数据源为 `btc-price all.csv`，支持 `YYYY-MM-DD` 与 `YYYY/M/D` 日期解析。
- 默认展示范围改为 `2017-10-01` 至 `2025-11-15`，并新增日期自定义输入。
- AHR999 阈值增加 `0.4` 选项与现有频率设置。
- 新增"按价格均线"模块，支持 `200/350/700/1000` 日均线与条件/频率组合。

---
仓库地址： https://github.com/lovexw/dca

小吴乐意主页： https://www.xiaowuleyi.com/
